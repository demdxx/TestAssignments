C++ MySQL Connector with memory cache
=====================================

    @author Dmitry Ponomarev <demdxx@gmail.com>
    @year 2013

Задача
======

Имеем базу данных с единственной таблицей:

    records
    {
        key : varchar
        data : text
    }

Имеем многопоточное приложение, которое работает с записями в этой таблице.
Необходимо реализовать класс-прослойку(кэш) между приложением и базой данных со следующими свойствами:
 - Одновременно с одной записью в кэше должен работать только один поток в приложении.
 - Несколько потоков должны иметь возможность работать с несколькими разными записями параллельно.
 - Прослойка должна кэшировать записи и сохранять изменения в базу данных с заданной периодичностью.
 - Если поток запросил запись, которая занята другим потоком, то он должен ждать записи некоторое время, по истечению которого выкинуть исключение.
 - Если поток запросил запись, которой нет в кэше, то кэш должен подгрузить её из базы.
 - Если поток запросил запись, которой нет в базе данных, то кэш должен создать пустую запись в базе с запрашиваемым ключом.

INFO
====

    Compiler: llvm-gcc 4.2
    C dialect: GNU99
    C++ dialect: GNU++98
    MySQL: 5.6
    MySQL Connector: 1.1.3
    boost: 1.53
    pthread

```sql
CREATE TABLE IF NOT EXISTS records (
   `key` VARCHAR(32) NOT NULL UNIQUE
 , `data` TEXT NOT NULL
 , PRIMARY KEY (`key`)
) ENGINE = MyISAM;
```

Используется MySQL с Connector/C++ (http://dev.mysql.com/downloads/connector/cpp/). Используется динамическая линквка с libmysqlcppconn.7.dylib

При использовании 1го коннектора возникают проблемы с выделением памяти. Вполне возможно что Connector/C++ не поддерживает создание одновременно нескольких запросов. (Прастите уж нестал разбираться)

Записи кэшируются в boost::unordered_map, поскольку они отсутствуют в std:: для libstdc++ GCC который присутствует в libc++ для LLVM.

Разделяемый доступ к записям организуется посредством mutex.

P.S.
====

Было лень делать make, и воспользовался XCode. Соответственно версия библиотеки использовалась под Mac OS.

Прошу не воспринимать данный код как что-то законченое или написаное с практической целью.

Комментов в коде мало. Были использованы некрасивые inline методы.

Connector/C++ при компиляции с libc++ выдеёт ошибки памяти в libstdc++.dylib.

